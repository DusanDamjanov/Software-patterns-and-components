<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        {% load static %}
        <link rel='stylesheet' href="{% static 'style.css' %}"/>
        <title> {{title}} </title>
    </head>
    <body>
        <div class="page">
            <div class="header">
                <label for="data-type-selector">Select type of data to parse: </label>
                <select id="data-type-selector" style="width: 160px;">
                    {% for loader in loaders %}
                        <option value="{{ loader.name }}">{{ loader.name }}</option>
                    {% endfor %}
                </select>
                <label for="data-content-selector" >Select which file to parse: </label>
                <select id="data-content-selector" style="width: 160px;">
                    {% for file in data %}
                        <option value="{{ file }}">{{ file }}</option>
                    {% endfor %}
                </select>
                <label for="visualizator-type-selector">Select type of visualization: </label>
                <select id="visualizator-type-selector" style="width: 160px;">
                    {% for visualizer in visualizers %}
                    <!-- izmenila sam u visualizer.identifier umesto samo viusalizer-->
                        <option value="{{ visualizer.name }}">{{ visualizer.name }}</option>
                    {% endfor %}
                </select>
                <button id="start-parsing" type="button">Start parse</button>
            </div>
            <div class="graphs">
                <div class="left">
                    {% block treeView %}
                    {% endblock %}
                </div>
                <div class="right">
                    {% block graphView %}
                    {% endblock %}
                </div>
            </div>
        </div>
<!-- Include jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
    // JavaScript code to handle "Start parse" button click event
    $("#start-parsing").on("click", function () {
        var loader = $("#data-type-selector").val();
        var file = $("#data-content-selector").val();
        var csrf_token = "{{ csrf_token }}";  // Add CSRF token if needed


        // Make an AJAX request to trigger the simple_visualization view
        $.ajax({
            url: "{% url 'simple_visualization_data_processing' %}",
            method: "POST",
            data: {
                loader: loader,
                file: file,
                csrfmiddlewaretoken: csrf_token

            },
            success: function (response) {
                // Handle successful response, e.g., render the visualization
                renderVisualization(response.visualization_data, response.forest);
            },
            error: function (xhr, status, error) {
                // Handle error
                console.error(error);
            }
        });
    });

    // Function to render the visualization data
    function renderVisualization(visualizationData, forest) {
        // Add your visualization rendering code here
        console.log("Visualization data:", visualizationData);
        console.log("Forest: ", forest)
    }
</script>




    </body>
</html>